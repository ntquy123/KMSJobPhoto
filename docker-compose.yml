version: '3.8'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: kmsjobphoto-dotnet-api
    expose:
      - "8083"
    # Host Linux server already runs an Nginx reverse proxy on port 8080.
    # To reuse that proxy instead of starting another Nginx container here,
    # publish the API directly so the existing proxy can route to it.
    ports:
      - "8083:8083"
    volumes:
      # Bind host upload storage so the app can persist uploaded files without code changes
      - /home/data/PKKMS/upload:/home/data/PKKMS/upload
      - ./upload:/upload
      - ./downloads:/usr/share/nginx/PKKMS/downloads:ro
    restart: always

  # nginx:
  #   image: nginx:latest
  #   container_name: kmsjobphoto-nginx-proxy
  #   # Disabled because host already has Nginx bound to 8080; enabling this
  #   # service would conflict with the running instance. Keep the block for
  #   # reference if deploying in an isolated environment without an external proxy.
  #   ports:
  #     - "8083:8083"
  #   volumes:
  #     - ./nginx/kmsjobphoto.conf:/etc/nginx/conf.d/kmsjobphoto.conf:ro
  #     - ./swagger-ui-5.30.2:/usr/share/nginx/pkwms/swagger-ui-5.30.2:ro
  #   depends_on:
  #     - app
  #   restart: always
